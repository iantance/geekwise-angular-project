<div ng-include = "'navbar.html'"></div>
<h1>Project: {{project.title}} <a tooltip="edit project" href="/#/projects/edit/{{project._id}}"><img src="images/glyphicons_150_edit.png"></a></h1>
<dl class="dl-horizontal">
	<dt>Description:</dt> <dd>{{project.description}}</dd>
	<dt>Status:</dt> <dd>{{project.status}}</dd>
	<dt>Team:</dt>
	<dd>
		<ul class = "list-unstyled">
			<li ng-repeat = "user in project.team">{{user.lastName}}, {{user.firstName}}</li>
		</ul>
	</dd>
</dl>
<accordion class="convogroup">
	<accordion-group ng-repeat = "conversation in project.conversations"> 
		<accordion-heading>	
				
				<img tooltip="edit conversation" ng-click="$parent.editSubject($parent.conversation, $index)" src="images/glyphicons_150_edit.png"/>
				<span ng-show="!editconvo[$index]" class = "span-left" tooltip="view messages"> Subject: {{conversation.subject}}</span>
				<div ng-show="editconvo[$index]">
					<form class="form-group editconvoform">
						<label for="editsubject" class="control-label"> Subject:</label>
						<input class="form-control" id="editsubject" ng-model = "conversation.subject"/>
						<button class="btn btn-default" ng-click="editConvo(conversation)">save</button>
						<button class="btn btn-default" ng-click="cancelEdit(conversation, $index)">cancel</button>
					</form>
				</div>

				<span ng-show="!editconvo[$index]" tooltip="view messages" class = "span-right">{{conversation.messages.length}} messages</span>
			
		</accordion-heading>
		<div ng-hide="editconvo[$index]">
			<div messages></div>
<!-- 			  <div ng-hide="editconvo[$parent.$index]">				
				<div class= "messagegroup" ng-repeat="message in conversation.messages">
			  		<h4>message {{$index + 1}}</h4>
			  		<div ng-show="edit">
				  		<textarea ng-model = "message.message"></textarea>
				  		<div>
				  			<button class="btn btn-default" ng-click="edit = !edit">cancel</button>
				  			<button class="btn btn-default" ng-click="editMessage(message)">save</button>
				  		</div>
					</div>
			  		<p ng-show="!edit" ng-bind-html="message.message | linky"></p>
			  		<button ng-show="!edit" class="btn btn-default" ng-click= "edit = !edit">edit</button>
			  		<div>
			  			<h5>user: {{message.user.lastName}}, {{message.user.firstName}}</h5>
			  			<h6>last modified: {{message.modified | date:'medium'}}</h6>
			  		</div>
		
			  	</div>
				<form class = "addmessage form-horizontal">
				  	<div class="form-group">
				  		<label for="message">add new message</label>
				  	 	<textarea name = "message" id="message" ng-model = "newMessage.message" rows = "5"></textarea>
				  	</div>
					<div class="form-group">
						<div>
						<select ng-model = 'newMessage.user' ng-options='user as [user.lastName, space+user.firstName] for user in project.team'>
				  			<option value=''>- select commenter -</option>
						</select>
						</div>
				  		<button class = "btn btn-default" ng-disabled ="!newMessage.user || !newMessage.message" ng-click="addMessage(newMessage, project._id, conversation._id)">add message</button>
				  	</div>
			  	</form>
			  </div> -->
		</div>
	</accordion-group>
</accordion>
<h2 class= "text-center" ng-show = "emptyConvo">No Conversations</h2>
<button class="btn btn-default showConvo" ng-click="addConvo=!addConvo">Start New Conversation</button>
<div class="addconvo slide" ng-if="addConvo">
	<form class="convoform form-horizontal" name= "convoform" novalidate>
		<div class="form-group"><label class="control-label col-lg-12"for="subject">Subject</label>
				<input class="form-control" type ="text" name = "subject" id= "subject" ng-model="newConversation.subject" placeholder="subject" required>
				<span ng-show="convoform.subject.$error.required"> subject required</span>
		</div>
		<div>
			<select ng-model = 'newConversation.messages.user' ng-options='user as [user.lastName, space+user.firstName] for user in project.team'>
	  			<option value=''>- select commenter -</option>
			</select>
		</div>
		<div class="form-group">
			<label class="control-label"for="newMessage">Message</label>
			<textarea ng-model = "newConversation.messages.message" class="form-control" rows = "5"></textarea>
		</div>
		<button ng-disabled = "newConversation.messages.message && !newConversation.messages.user" class = "btn btn-default" ng-disabled="convoform.$invalid" ng-click="addConversation(newConversation, project._id)">Add Conversation</button>
	</form>
</div>


